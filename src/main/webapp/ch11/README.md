## 커넥션

커넥션이란 애플리케이션과 데이터베이스의 연결로서, 애플리케이션에서 데이터베이스에 접속하고 접속을 종료하는 일련의 과정

- 동시 접속 사용자가 늘어나면 프로그램에서 데이터베이스를 연결하고 종료하는 일련의 과정은 시스템에 많은 부하를 주게 된다. 이러한 비효율적인 구조를 개선하기 위하여 커넥션 풀(Connection Pool)을 사용

## 트랜잭션

트랜잭션은 여러 작업을 하나의 단위로 처리하는 것을 말하는데, 대부분의 데이터베이스가 이러한 트랜잭션 처리를 위한 메커니즘을 제공

- 작업들이 서로 연관되어 있을 때 하나의 작업이 최종적으로 완료되기 위해 다른 작업들이 모두 정상적으로 완료되어야 하거나 혹은 잘못될 경우 앞에서 처리한 작업을 원래대로 되돌릴 필요가 있기 때문

## 데이터베이스 커넥션 풀

데이터베이스 커넥션 풀이란 애플리케이션에서 필요로 하는 시점에 커넥션을 만드는 것이 아니라 미리 일정한 수의 커넥션을 만들어놓고 필요한 시점에 애플리케이션에서 제공하는 서비스

## 커넥션 풀의 구조와 동작

1. 웹 애플리케이션 서버가 시작될 때 일정 수의 커넥션을 미리 생성한다.
2. 웹 애플리케이션 요청에 따라 생성된 커넥션 객체를 전달한다.(JNDI 이용)
3. 일정 수 이상의 커넥션이 사용되면 새로운 커넥션을 만든다.
4. 사용하지 않는 커넥션은 종료하고 최소한의 기본 커넥션을 유지한다.

## 커넥션 풀 구현 유형

- 직접 구현
- 아파치 자카르타 DBCP API를 이용한 구현
- 애플리케이션 서버 제공
  (javax.sql.DataSource 인터페이스 사용)
- 프레임워크 제공

## JNDI

- 시스템 자원이나 객체에게 이름과 속성을 부여하고 그 이름을 사용하여 자원이나 객체를 사용할 수 있도록 해주는 서비스

- WAS, 즉 톰캣이 제공하는 데이터소스(커넥션풀)을 프로그램에서 사용하기 위해서는 톰캣이 제공하는 JNDI 서비스를 사용하여 가져온다

## DataSource

- DataSource는 WAS가 실행하면서 생성하는 커넥션 풀 객체의 표준 인터페이스

- 프로그래머는 WAS가 실행 전에 커넥션 풀 생성을 위한 DB 관련 정보를 제공해야 함

## DBCP API를 통한 커넥션 풀 구현

톰캣 7.0에서 부터는 자체적으로 DBCP를 내장하고 있어 아파치 DBCP를 따로 설치할 필요가 없다.

- context.xml에서 설정하는 것을 권장

## xml 파일들

- server.xml : 서버 당 하나 파일이며 서버의 일반 구성 정보
- context.xml : 웹 APP 당 하나 파일이며 서버 관련 설정
- web.xml : 웹 APP당 하나의 파일이며 앱 자체 설정

## 트랜잭션

트랜잭션은 데이터베이스에서 일련의 작업을 하나로 묶어 처리하는 것을 의미한다.

- commit과 rollback은 데이터베이스에서 트랜잭션 지원을 위해 제공하는 기능이다.

## Commit

- 데이터베이스에서 트랜잭션이 완료되었음을 알리는 명령이다
- Commit이 완료되기까지 결과는 현재 커넥션에서만 유효하고, 다른 커넥션에서는 처리내용을 확인할 수 없다.
- 즉 commit이 완료되어야만 다른 커넥션에서도 변경된 데이터를 확인할 수 있다.
- conn.rollback()

## rollback

- 트랜잭션을 취소하는 명령으로, 현재 연결에서 수행한 결과를 원래대로 되돌리는 역할을 한다.
- 트랜잭션이 잘못되었을 경우 rollback을 이용해 모든 작업을 원래 상태로 되돌릴 수 있다.
- conn.rollback()

## auto commit 해제 방법

- conn.setAutoCommit(false) : auto commit 해제
- conn.setAutoCommit(true) : auto commit 설정

## 일괄갱신(Batch Update)

일괄 처리를 하나의 작업 단위로 트랜잭션 처리
